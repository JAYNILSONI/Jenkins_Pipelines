pipeline:
  agent:
    any: true

  stages:
    - stage: "Checkout_Stage"
      steps:
        - script: |
            echo "Checking out the Repository"
            def scmConfig = [
              \$class: 'GitSCM',
              branches: [[name: '*/dev']],
              userRemoteConfigs: [[url: 'https://github.com/JAYNILSONI/Jenkins_Pipelines.git']],
              extensions: [
                [\$class: 'CleanBeforeCheckout'],
                [\$class: 'CloneOption', noTags: false, shallow: true, depth: 1]
              ]
            ]
            checkout(scmConfig)

    - stage: "Dependence_Clean_Stage"
      steps:
        - bat 'mvn clean'

    - stage: "Build_Stage"
      steps:
        - bat 'mvn compile'

    - stage: "Test_Stage"
      steps:
        - bat 'mvn test'

    - stage: "Package_Stage"
      steps:
        - bat 'mvn package'

    - stage: "Execute_Stage"
      steps:
        - bat 'java -cp target/helloworld-1.0-SNAPSHOT.jar com.example.App'
        
    - stage: "Docker_Stage"
      steps:
        - bat 'docker build -t Jhelloworld-app:${BUILD_NUMBER} .'
        - bat 'docker tag Jhelloworld-app:${BUILD_NUMBER} ${DOCKER_REGISTRY}/Jhelloworld-app:${BUILD_NUMBER}'
        - bat 'docker tag Jhelloworld-app:${BUILD_NUMBER} ${DOCKER_REGISTRY}/Jhelloworld-app:latest'
        - bat 'docker push ${DOCKER_REGISTRY}/Jhelloworld-app:${BUILD_NUMBER}'
        - bat 'docker push ${DOCKER_REGISTRY}/Jhelloworld-app:latest'

  post:
    always:
      - echo "Performing Cleanup of Workspace"
      - deleteDir()
