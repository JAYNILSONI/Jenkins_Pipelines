pipeline:
  agent: any
  stages:
    - stage: "Checkout_Stage"
      steps:
        - script: |
            def checkoutScript = load 'scripts/checkoutScript.groovy'
            checkoutScript.doCheckout()
            
    - stage: "Dependence_Clean_Stage"
      steps:
        - bat 'mvn clean'
    - stage: "Build_Stage"
      steps:
        - bat 'mvn compile'
    - stage: "Test_Stage"
      steps:
        - bat 'mvn test'
    - stage: "Package_Stage"
      steps:
        - bat 'mvn package'
    - stage: "Execute_Stage"
      steps:
        - bat 'java -cp target/helloworld-1.0-SNAPSHOT.jar com.example.App'
    - stage: "Docker_Stage"
      steps:
        - bat 'docker build -t Jhelloworld-app:${BUILD_NUMBER} .'
        - bat 'docker tag Jhelloworld-app:${BUILD_NUMBER} ${DOCKER_REGISTRY}/Jhelloworld-app:${BUILD_NUMBER}'
        - bat 'docker tag Jhelloworld-app:${BUILD_NUMBER} ${DOCKER_REGISTRY}/Jhelloworld-app:latest'
        - bat 'docker push ${DOCKER_REGISTRY}/Jhelloworld-app:${BUILD_NUMBER}'
        - bat 'docker push ${DOCKER_REGISTRY}/Jhelloworld-app:latest'
  post:
    always:
      - echo "Performing Cleanup of Workspace"
      - deleteDir()
